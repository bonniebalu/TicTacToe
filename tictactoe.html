<HTML>
    <head>
        <style>
body div {
    text-align: center;
}            
.center {
  margin: auto;
  width: 50%;
  padding: 10px;
}
#gameNode {
    text-align: -webkit-center;
    padding: 5px;
}
#gameNode table {
    display: contents;
}
#gameNode table td {
    height: 50px;
    width: 50px;
    text-align: center;
}
#gameNode .col-1, #gameNode .col-2 {
    border-right: 2px solid black;
}
#gameNode .col-2, #gameNode .col-3 {
    border-left: 2px solid black;
}
#gameNode .row-1 td, #gameNode .row-2 td {
    border-bottom: 2px solid black;
}
#gameNode .row-2 td, #gameNode .row-3 td {
    border-top: 2px solid black;
}
.forTheWin {
    transition: color 2s;
    transition-timing-function: ease;
    color: darkseagreen;
    /* font-weight: bolder; */
}
.forTheLoose {
    transition: color 2s;
    transition-timing-function: ease;
    color: crimson;
    /* font-weight: bolder; */
}
html {
    font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
}
        </style>        
    </head>
    <body>
        <div>
            <h1 class="center">Tic Tac Toe</h1>            
            <div id="gameNode" class="center">                
                <table>
                    <tr class="row-1">
                        <td id="row-0-col-0" class="col-1" onClick="squareClicked(0,0)"></td>
                        <td id="row-0-col-1" class="col-2" onClick="squareClicked(0,1)"></td>
                        <td id="row-0-col-2" class="col-3" onClick="squareClicked(0,2)"></td>
                    </tr>
                    <tr class="row-2">
                        <td id="row-1-col-0" class="col-1" onClick="squareClicked(1,0)"></td>
                        <td id="row-1-col-1" class="col-2" onClick="squareClicked(1,1)"></td>
                        <td id="row-1-col-2" class="col-3" onClick="squareClicked(1,2)"></td>
                    </tr>
                    <tr class="row-3">
                        <td id="row-2-col-0" class="col-1" onClick="squareClicked(2,0)"></td>
                        <td id="row-2-col-1" class="col-2" onClick="squareClicked(2,1)"></td>
                        <td id="row-2-col-2" class="col-3" onClick="squareClicked(2,2)"></td>
                    </tr>
                </table>
                <h5 id="output-message"></h5>
            </div>
        </div>

        <script type="text/javascript">
            let gameBoard;
            let computer = 'o';
            let user = 'x';
            let gameOver;
            let waiting = false;

            function newGame(){
                gameOver = false;
                gameBoard = [['', '', ''],['', '', ''],['', '', '']];
                setMessage("Make your move");

                if(Math.floor(Math.random() * 2 < 1))
                    computersMove();
            }            

            function squareClicked(x,y) {
                console.log("x: " + x + " y: " + y);
                
                if (waiting || gameOver || gameBoard[x][y] !== '') return;

                updateCell(x, y, user);

                if (!isGameOver()){
                    setMessage("Computer is thinking...");

                    waiting = true;
                    setTimeout(() => { 
                        computersMove();
                        waiting = false;
                    }, 1000);
                }
            }

            function computersMove(){
                let picked = false;

                // try some strategies

                // look for a line with 2 same values, and one blank one
                if (!canOnePlayerWin(computer, computer) && !canOnePlayerWin(user, computer)) {
                    // randomly pick a free slot
                    while (picked == false) {
                        const row = Math.floor(Math.random() * 3);
                        const col = Math.floor(Math.random() * 3);
                        if (gameBoard[row][col] === ''){                        
                            updateCell(row, col, computer);
                            picked = true;
                        }
                    }
                }

                if (!isGameOver()){
                    setMessage("Your turn");
                }
            }

            function updateCell(x,y,value) {
                gameBoard[x][y] = value;
                document.getElementById("row-" + x + "-col-" + y).innerText = value;
            }

            function isGameOver(){
                // game is over in two cases:

                // there is a line
                if (hasLine(computer)) {
                    setMessage("You Lose :(");
                    gameOver = true;
                }
                else if (hasLine(user)) {
                    setMessage("You Win!");
                    gameOver = true;
                }

                // or all spaces have been used
                else if (!hasOpenSpace()) {
                    setMessage("Draw");
                    gameOver = true;
                }

                return gameOver;
            }

            function canOnePlayerWin(player, value) {

                const potentialPlayerWin = player + player + '';

                // horizontal line
                for (let x = 0; x < 3; x++) {
                    if (getLineValue(x, 0, x, 2) === potentialPlayerWin) {                        
                        const coordinates = getEmptyValueCoordinatesInLine(x, 0, x, 2);
                        updateCell(coordinates.x, coordinates.y, value);
                        return true;
                    }
                }

                // vertical line
                for (let y = 0; y < 3; y++) {
                    if (getLineValue(0, y, 2, y) === potentialPlayerWin) {                        
                        const coordinates = getEmptyValueCoordinatesInLine(0, y, 2, y);
                        updateCell(coordinates.x, coordinates.y, value);
                        return true;
                    }
                }

                // diagonals
                if (getLineValue(0, 0, 2, 2) === potentialPlayerWin) {
                    const coordinates = getEmptyValueCoordinatesInLine(0, 0, 2, 2);
                    updateCell(coordinates.x, coordinates.y, value);
                        return true;
                }
                else if (getLineValue(2, 0, 0, 2) === potentialPlayerWin) {
                    const coordinates = getEmptyValueCoordinatesInLine(2, 0, 0, 2);
                    updateCell(coordinates.x, coordinates.y, value);
                    return true;
                }

                return false;
            }

            function getEmptyValueCoordinatesInLine(x1, y1, x3, y3){
                let emptyX, emptyY;
                const x2 = (x1+x3)/2;
                const y2 = (y1+y3)/2;

                if (gameBoard[x1][y1] === '')
                {
                    emptyX = x1;
                    emptyY = y1;
                }
                else if (gameBoard[x2][y2] === '')
                {
                    emptyX = x2;
                    emptyY = y2;
                }
                else if (gameBoard[x3][y3] === '')
                {
                    emptyX = x3;
                    emptyY = y3;
                }

                return {
                    x: emptyX,
                    y: emptyY
                };
            }

            function hasLine(player) {

                const playerLine = player + player + player;

                // horizontal line
                for (let x = 0; x < 3; x++) {
                    if (getLineValue(x, 0, x, 2) === playerLine) {
                        addWinningClass(x, 0, x, 2, player);
                        return true;
                    }
                }

                // vertical line
                for (let y = 0; y < 3; y++) {
                    if (getLineValue(0, y, 2, y) === playerLine) {
                        addWinningClass(0, y, 2, y, player);
                        return true;
                    }
                }

                // diagonals
                if (getLineValue(0, 0, 2, 2) === playerLine) {
                    addWinningClass(0, 0, 2, 2, player);
                    return true;
                }
                else if (getLineValue(2, 0, 0, 2) === playerLine) {
                    addWinningClass(2, 0, 0, 2, player);
                    return true;
                }

                return false;
            }

            function addWinningClass (x1, y1, x3, y3, player) {
                const x2 = (x1+x3)/2;
                const y2 = (y1+y3)/2;

                const className = player === computer ? "forTheLoose" : "forTheWin";

                document.getElementById("row-" + x1 + "-col-" + y1).classList.add(className);
                document.getElementById("row-" + x2 + "-col-" + y2).classList.add(className);
                document.getElementById("row-" + x3 + "-col-" + y3).classList.add(className);
            }

            function getLineValue(x1, y1, x3, y3) {
                let line = '';

                const x2 = (x1+x3)/2;
                const y2 = (y1+y3)/2;

                line += gameBoard[x1][y1];
                line += gameBoard[x2][y2];
                line += gameBoard[x3][y3];

                return line;
            }

            function hasOpenSpace() {
                for (let x = 0; x < 3; x++){
                    for (let y = 0; y < 3; y++){
                        if (gameBoard[x][y] === '') {
                            return true;
                        }
                    }
                }

                return false;
            }

            function setMessage(value) {
                document.getElementById('output-message').innerText = value;
            }

            newGame();
        </script>
    </body>
</HTML>